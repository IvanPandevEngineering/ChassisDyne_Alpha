# ChassisDyne
SAFETY DISCLAIMER: This repository is intended strictly as a technical showcase for public viewing and commentary, NOT for public use, editing, or adoption. The simulation code within has not been fully validated for accuracy or real-world application. Do NOT apply any changes to real-world vehicles based on ChassisDyne simulation results. Modifying vehicle properties always carries a risk of deadly loss of vehicle control. Any attempt to use this software for real-world applications is highly discouraged and done at the userâ€™s own risk. The author assumes no liability for any consequences arising from such misuse. All rights reserved, Copyright 2024 Ivan Pandev.

## Multibody, time-dependent vehicle simulations by Ivan Pandev
ChassisDyne is a chassis response calculator solving for tire load, lateral load distribution, and other variables not directly measurable over time, using either real-world acceleration telemetry, or synthetic acceleration and road surface data as inputs. Intuitively speaking, ChassisDyne is a virtual '7+2'-post shaker rig, signifying that it can replay body acceleration inputs in addition to conventional 7-post shaker functionality.

The vehicle model consists of 6 solid bodies: Front chassis and rear chassis (connected by a torsion spring), and 4 unsprung suspension masses connected to the chassis by variations of springs, roll bars, dampers, etc. The system of differential equations describing the model's response is found in `chassis_model.py.` The transient response of this model is then solved using Runge-Kutta methods in `RK4_iterator.py,` and variables of interest are collected.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/demo4.png)

The above screenshot generated by ChassisDyne represents a race car model, `Battle_Bimmer_30_Sept_2023_w_Pass.yml`, responding to synthetic lateral and longitudinal inputs, with a bump affecting the inside tires on the right-handed turn. Demonstrated in the data is torsional chassis flex, suspension and tire harmonics, 0-load behavior on individual wheels, and much more. The screenshot generated by ChassisDyne below represents the same model responding to a replay of telemetry gathered during a real-world autocross race run, where chassis acceleration is known precisely, but surface conditions are assumed smooth.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/demo3.png)

ChassisDyne can perform frequency sweeps to find uncontrolled harmonics in a simulated chassis, as in the results below. In the case of the model `Battle_Bimmer_30_Sept_2023_w_Pass.yml` at a lateral acceleration mangnitude of 1.2G, the front and rear axles reach their harmonics at roughly 3hz and 5hz, respectively, where the inside tires can lift off the ground and the model becomes generally uncontrolled. Tuning the model's spring and damper parameters might improve its performance in these domains.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/roll_frequency_sweep_1.PNG)

In addition to time-dependent response, ChassisDyne also offers steady-state response variables for at-a-glance evaluation of a vehicle's dynamics. The below is the return of the summary() method of the `Battle_Bimmer_28_Dec_2022` model.

```
_______ ROLL RESPONSE _______
Roll Gradient: 1.48 deg/G
Roll Frequency: 3.168 hz
Roll Damping Ratio (Slow): 0.631
Roll Damping Ratio (Fast): 0.407
Lateral Load Distribution Front: +38.085 % Outside/G
Lateral Load Distribution Rear: +39.538 % Outside/G
Lateral Load Distribution Ratio: +0.963 % Front/G
Tip-Over G: 1.675 G


_______ PITCH RESPONSE _______
Pitch Gradient, Accel: 0.687 deg/G
Pitch Gradient, Decel: 0.515 deg/G
Pitch Frequency*: 2.915 hz
Pitch Damping Ratio* (Slow): 0.68
Pitch Damping Ratio* (Fast): 0.444
Longitudinal Load Distribution: +/-17.677 % Front/G
* - taken from contact-patch-to-IC line, see documenation.


_______ AERO PLATFORM RESPONSE _______
Pitch Angle Change: -0.02 degrees, dive
Front Ride Height Change: 2.526 mm
Rear Ride Height Change: 3.476 mm
Stability Margin: 185.856 mm, stability


_______ FRONT RIGHT CORNER _______
Wheel Rate: 65.13 N/mm
Natural Frequency: 2.627 hz
Damping Ratio, Slow Compression: 0.403 -/-
Damping Ratio, Slow Rebound: 0.644 -/-
Damping Ratio, Fast Compression: 0.222 -/-
Damping Ratio, Fast Rebound: 0.413 -/-


_______ FRONT LEFT CORNER _______
Wheel Rate: 65.13 N/mm
Natural Frequency: 2.6 hz
Damping Ratio, Slow Compression: 0.399 -/-
Damping Ratio, Slow Rebound: 0.638 -/-
Damping Ratio, Fast Compression: 0.22 -/-
Damping Ratio, Fast Rebound: 0.408 -/-


_______ REAR RIGHT CORNER _______
Wheel Rate: 51.825 N/mm
Natural Frequency: 2.673 hz
Damping Ratio, Slow Compression: 0.35 -/-
Damping Ratio, Slow Rebound: 0.678 -/-
Damping Ratio, Fast Compression: 0.2 -/-
Damping Ratio, Fast Rebound: 0.512 -/-


_______ REAR LEFT CORNER _______
Wheel Rate: 51.825 N/mm
Natural Frequency: 2.487 hz
Damping Ratio, Slow Compression: 0.326 -/-
Damping Ratio, Slow Rebound: 0.631 -/-
Damping Ratio, Fast Compression: 0.187 -/-
Damping Ratio, Fast Rebound: 0.477 -/-


_______ MASS DISTRIBUTION _______
Front Axle Mass Distribution: 52.973 %
Left Mass Distribution: 51.549 %
Cross-Wise Mass Distribution (FL/RR): 48.911 %
```

## Real-World Correlation
Maximizing correlation against real-world telemetry will drive and validate ChassisDyne development. While some ChassisDyne outputs like instantaneous tire load are extremely difficult to measure directly and capture in telemetry, ChassisDyne also predicts measurable responses to g-force, such as roll and pitch angle rates. As a cursory validation of ChassisDyne outputs' correlation to real-world vehicle's behavior, its simulated roll angle rate outputs are compared to the corresponding data from telemetry. The correlation is optimized around the 750ms smoothing window.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/corr3.png)

The choice to check correlation using roll angle rate was driven by it being the only available, reliable trace at the time. Roll and pitch angle traces were found to drift, and the sensor mount itself could be more rigid. Improvements to the sensor mount and trace selection will follow with future data collection runs.

## ML Training Data Synthesis
ChassisDyne can iterate through a range of values of a vehicle property and simulate the chassis response of a vehicle with those properties, all for a given acceleration input. The graphic below shows a range of center of mass heights and their related impact on roll angle rate. These series can be combined with the real-world chassis response of that acceleration input, and packaged as a dataset for machine learning projects. See the method `data_synth_for_ML()` in `vehicle.py` for more detail.

![alt text](https://github.com/IvanPandevEngineering/ChassisDyne_Alpha/blob/main/images/mlTrainDemo.png)

## Ongoing Development
ChassisDyne's core functionality is practically complete, but much work remains on capturing increasingly-granular details of vehicle response. This includes but is not limited to:
- Improved pitch response to engine torque
- Frequency-domain analysis
- Damper hysteresis

Looking far ahead, ChassisDyne can also benefit from quality-of-life/ productization improvements such as a primitive GUI, synthetic input generator, and more generalized telemetry ingestion and reformatting.
